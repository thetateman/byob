<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=leqv3v-yTsJNC7nFznSMqY8sH8TbxaykjKLHSI8pmzk);ol{margin:0;padding:0}table td,table th{padding:0}.c7{-webkit-text-decoration-skip:none;color:#000000;font-weight:700;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-size:14pt;font-family:"Arial";font-style:normal}.c6{background-color:#d9d9d9;color:#000000;font-weight:500;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Source Code Pro";font-style:normal}.c3{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:italic}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c4{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c8{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c5{color:inherit;text-decoration:inherit}.c2{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c8 doc-content"><p class="c0"><span class="c7">How to deploy a full-stack web app in 5 minutes</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">They will cease to exercise memory because they rely on that which is written, calling things to remembrance no longer from within themselves, but by means of external marks. - Plato on the invention of writing</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span>Apparently, Plato peered into the future to comment on my process of navigating website deployment. I&rsquo;ve deployed webapps quite a few times now, using similar tech stacks, yet every time I find myself searching Google for the same questions and subsequently forgetting the answers. I punch in the words &ldquo;Allow traffic ports 80 443 Google Cloud VM not working&rdquo; and those accusing purple links stare back at me. Yesterday, when I deployed a webapp for the n-th time, it still took me about 90 minutes of Googling and ChatGPTing to arrive at my goal - running Nginx and Node on a VPS to serve webpages on my domain with TLS encryption. No matter how many times I go through this process, I can never remember all the steps without relying on that which is written. This post is an attempt to document all the steps in one place; it is more a reference for my own use than it is a tutorial for anyone else.</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">In this reference, I use the following &ldquo;stack&rdquo; of technologies: Google Cloud Platform, Linux, Express, Node, Nginx (the GLENN stack). If you&rsquo;re using different tools, you may need to adapt this guide to suit your needs. note the lack of frontend tools, this reference is just the steps to deploy a starter app, that only serves a Hello World html page.</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c6">Set up Google Cloud Virtual Machine</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Set up Google Cloud Platform account, project, billing, etc. (I&rsquo;m not walking through that step by step)</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Create an instance: </span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 109.33px;"><img alt="" src="images/image4.png" style="width: 624.00px; height: 109.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c1">&nbsp;</span></p><p class="c0"><span class="c1">Configure the instance (virtual machine) to fit your needs, the important thing is to allow HTTP and HTTPS traffic: </span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 543.00px; height: 120.00px;"><img alt="" src="images/image5.png" style="width: 543.00px; height: 120.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c1">This will create firewall rules to allow traffic on the ports 80 and 443 (the standard ports for HTTP and HTTPS)</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">The VM should take about a minute to create. Then you can click the &ldquo;SSH&rdquo; button to use GCP&rsquo;s browser based SSH to connect to the machine. </span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 145.33px;"><img alt="" src="images/image8.png" style="width: 624.00px; height: 145.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">This will bring up a new browser window where you can interact with the machine through a terminal.</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">install Node &amp; NPM</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span>We&rsquo;ll start by installing node and npm. There are several ways to install node, but the best way to get the latest version is to download the binaries from the Node download page </span><span class="c4"><a class="c5" href="https://www.google.com/url?q=https://nodejs.org/en/download&amp;sa=D&amp;source=editors&amp;ust=1688570774362579&amp;usg=AOvVaw1KSEV0CIbfpc0VgNpAO7EU">https://nodejs.org/en/download</a></span><span>&nbsp;Copy the link for the Linux Binaries (x64). It should look something like this: </span><span class="c4"><a class="c5" href="https://www.google.com/url?q=https://nodejs.org/dist/v18.16.1/node-v18.16.1-linux-x64.tar.xz&amp;sa=D&amp;source=editors&amp;ust=1688570774362817&amp;usg=AOvVaw3YPwqoOtfg_Tx3XCMnQBbX">https://nodejs.org/dist/v18.16.1/node-v18.16.1-linux-x64.tar.xz</a></span><span class="c1">&nbsp;. Back in the SSH window we will run commands to install node:</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span>curl -O </span><span class="c4"><a class="c5" href="https://www.google.com/url?q=https://nodejs.org/dist/v18.16.1/node-v18.16.1-linux-x64.tar.xz&amp;sa=D&amp;source=editors&amp;ust=1688570774363083&amp;usg=AOvVaw2-KzU0kejPGaKeZGLjlLJO">https://nodejs.org/dist/v18.16.1/node-v18.16.1-linux-x64.tar.xz</a></span><span class="c1">&nbsp;(replace with the link you copied)</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">extract the contents to your install directory:</span></p><p class="c0"><span class="c1">sudo tar -xJvf node-v18.16.1-linux-x64.tar.xz -C /opt &nbsp;(use the name of the file you downloaded)</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">then you can remove the tar file:</span></p><p class="c0"><span class="c1">rm node-v18.16.1-linux-x64.tar.xz</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Now you&rsquo;ll want to add the binaries to your path, so you can access them easily in the terminal. To do this you&rsquo;ll edit your .profile file:</span></p><p class="c0"><span class="c1">&nbsp;run: </span></p><p class="c0"><span class="c1">sudo vim ~/.profile</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">and add this line at the end of the file (change the name to match your node version):</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 577.33px;"><img alt="" src="images/image2.png" style="width: 624.00px; height: 577.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Refresh your terminal:</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">. ~/.profile</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">verify that node installation worked.</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">node -v</span></p><p class="c0"><span class="c1">npm -v</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">You&rsquo;ll also want to create a symbolic link to node and npm in the /usr/bin directory. This allows sudo to find the programs, in case you need to use &ldquo;sudo node &hellip;&rdquo; or &ldquo;sudo npm &hellip;&rdquo;</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp;sudo ln -s /opt/node-v18.16.1-linux-x64/bin/node /usr/bin/node</span></p><p class="c0"><span class="c1">sudo ln -s /opt/node-v18.16.1-linux-x64/bin/npm /usr/bin/npm</span></p><p class="c0"><span class="c1">sudo ln -s /opt/node-v18.16.1-linux-x64/bin/npx /usr/bin/npx</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">clone git project</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Install git with:</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">sudo apt install git</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Clone the starter project with git:</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span>git clone </span><span class="c4"><a class="c5" href="https://www.google.com/url?q=https://github.com/thetateman/node-express-app-template&amp;sa=D&amp;source=editors&amp;ust=1688570774364945&amp;usg=AOvVaw1JayFe9PPevtjcFSuNPkde">https://github.com/thetateman/node-express-app-template</a></span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">make sure we can run the project.</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">cd node-express-app-template</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Install dependencies with npm</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">npm install</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">cd server</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">node server.js</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">install and configure PM2</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">PM2 is a process manager that lets us manage our server process easily and even configure our server to start on startup so our app is resilient in the case that the machine crashes or restarts.</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">First install PM2</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">sudo npm i -g pm2</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">run the following commands to configure the node server to run on startup</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">pm2 start server.js</span></p><p class="c0"><span class="c1">pm2 save</span></p><p class="c0"><span class="c1">pm2 startup systemd (paste and run the command it gives you here)</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Install Nginx</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">sudo apt install nginx</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">edit the default sites config</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">sudo vim /etc/nginx/sites-available/default</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">change the location block to proxy traffic to localhost at port 8080</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 489.33px;"><img alt="" src="images/image7.png" style="width: 624.00px; height: 489.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">configure Nginx</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">edit the nginx.conf file:</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">sudo vim /etc/nginx/nginx.conf</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">At the bottom of the http block, add the following server block:</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">server {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; server_name &lt;your external ip address&gt; www.&lt;your domain name&gt; &lt;your domain name&gt;;</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; location / {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proxy_set_header Host $host;</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proxy_pass http://localhost:8080;</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proxy_http_version 1.1;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proxy_set_header Upgrade $http_upgrade;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proxy_set_header Connection &quot;upgrade&quot;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Not all of these settings are strictly necessary for serving webpages, some are just helpful if you want https, or if you need to access users&rsquo; IP addresses in the node server. This is what that section of the file should look like after you edit it:</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 277.33px;"><img alt="" src="images/image9.png" style="width: 624.00px; height: 277.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Now start nginx using</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">sudo service nginx start</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Let&rsquo;s do a sanity check to make sure every thing is working so far. We should be able to reach our machine from the public internet with its external ip. &nbsp;And nginx should proxy requests that come in on port 80 to our node server. To test this, in a browser we go to http://&lt;your external ip&gt;</span></p><p class="c0"><span class="c1">You should see a page like this:</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 576.00px; height: 245.00px;"><img alt="" src="images/image6.png" style="width: 576.00px; height: 245.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c1">This means our server is running and serving a webpage to the public internet!</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Notice how we can only get here using the IP address, we can&rsquo;t use https, and the browser doesn&rsquo;t even load any CSS! We will address all of this in the next few steps.</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Let&rsquo;s Encrypt</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span>We&rsquo;ll use Certbot to automatically create and renew our TLS certificate, so we can use HTTPS. Follow all the instructions here: </span><span class="c4"><a class="c5" href="https://www.google.com/url?q=https://certbot.eff.org/instructions?ws%3Dnginx%26os%3Dubuntufocal%26tab%3Dstandard&amp;sa=D&amp;source=editors&amp;ust=1688570774368284&amp;usg=AOvVaw1RvkmUUBye4U5TyrJNLSW1">https://certbot.eff.org/instructions?ws=nginx&amp;os=ubuntufocal&amp;tab=standard</a></span><span class="c1">&nbsp;</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Configure DNS records</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">One last step to use an actual domain name instead of an IP address! Go to your domain registrar&rsquo;s site and add DNS records for your domain to point at your IP address. You will just need to add an A record with your IP address like this:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 258.67px;"><img alt="" src="images/image1.png" style="width: 624.00px; height: 258.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">You may need to wait a few hours for the DNS records to propagate. To test if everything is working correctly visit your domain in a browser. You should see the starter webpage:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 257.33px;"><img alt="" src="images/image3.png" style="width: 624.00px; height: 257.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">Congratulations on deploying a full-stack webapp to the internet! We used a lot of tools just to display a static page in the browser, but this tech stack is a powerful foundation upon which you can build basically any web-based application you can imagine. </span></p></body></html>